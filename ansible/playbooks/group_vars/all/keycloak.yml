---
# Global defaults for keycloak_config

# Core connection & auth to Keycloak
keycloak_config_url: "https://keycloak.pub.l-it.io"
keycloak_config_master_realm: "master"
keycloak_config_client_id: "admin-cli"
keycloak_config_username: "admin"
# Read the admin password from environment to avoid storing secrets in git
keycloak_config_password: "admin"
# Optional: use a client secret instead of username/password
keycloak_config_client_secret: ""

# Terraform execution settings
keycloak_config_tf_workdir: "/workspace/infra/keycloak"
keycloak_config_tf_clean_state: false
keycloak_config_skip_apply: false

# Realms and clients
keycloak_config_realms:
  - name: "demo01"
    display_name: "DEMO01"

keycloak_config_clients:
  - client_id: "app-frontend"
    realm: "demo01"
    client_type: "public"
    redirect_uris:
      - "https://example.app/*"

  - client_id: "openshift"
    name: "OpenShift OAuth"
    realm: "demo01"
    client_type: "confidential"
    client_secret: "install"
    standard_flow_enabled: true
    direct_access_grants_enabled: false
    protocol: "openid-connect"
    default_client_scopes:
      - "profile"
      - "email"
      - "roles"
      - "web-origins"
    optional_client_scopes:
      - "address"
      - "phone"
      - "acr"
    redirect_uris:
      - "https://oauth-openshift.example.com/*"
    web_origins:
      - "+"

# ---------------------------------------------------------------------------
# Local user & group management (within Keycloak)
# ---------------------------------------------------------------------------

keycloak_config_users: []
keycloak_config_service_accounts: []
keycloak_config_groups: []
keycloak_config_default_groups: []
keycloak_config_realm_roles: []
keycloak_config_client_scopes: []
keycloak_config_client_roles: []

# Bind AD group names to realm-management roles for delegated admin in demo01
# (still local RBAC inside Keycloak, even if group names come from AD)
keycloak_config_role_bindings:
  - realm: "demo01"
    target: "group"
    target_name: "grp-demo01-admin"
    client: "realm-management"
    roles:
      - "realm-admin"

  - realm: "demo01"
    target: "group"
    target_name: "grp-demo01-poweruser"
    client: "realm-management"
    roles:
      - "manage-users"
      - "view-users"
      - "view-realm"

  - realm: "demo01"
    target: "group"
    target_name: "grp-demo01-readonly"
    client: "realm-management"
    roles:
      - "view-users"
      - "view-realm"

# ---------------------------------------------------------------------------
# Additional identity providers & federation (AD / Kerberos, etc.)
# ---------------------------------------------------------------------------

keycloak_config_identity_providers: []
keycloak_config_identity_provider_mappers: []

keycloak_config_ldap_user_federations:
  - name: "ad-prod"
    realm: "demo01"
    auth_type: "simple"
    vendor: "AD"
    bind_dn: "CN=svc-keycloak,OU=Service,DC=ad,DC=example,DC=com"
    bind_credential: "install"
    connection_url: "ldaps://ad.example.com:636"
    users_dn: "OU=Users,DC=ad,DC=example,DC=com"
    username_ldap_attribute: "sAMAccountName"
    rdn_ldap_attribute: "cn"
    uuid_ldap_attribute: "objectGUID"
    user_object_classes:
      - "person"
      - "organizationalPerson"
      - "user"
    search_scope: "SUBTREE"
    import_enabled: true
    sync_registrations: false
    priority: 0
    use_truststore_spi: "ONLY_FOR_LDAPS"
    pagination: true
    validate_password_policy: false
    connection_timeout: 5000
    read_timeout: 10000
    batch_size_for_sync: 1000

keycloak_config_kerberos_user_federations: []

# ---------------------------------------------------------------------------
# Realm-wide settings (themes, mail, policies, sessions, tokens)
# ---------------------------------------------------------------------------

keycloak_config_theme_settings:
  - realm: "demo01"
    login_theme: "keycloak.v2"
    account_theme: "keycloak.v3"
    admin_theme: "keycloak.v2"
    email_theme: "keycloak"

keycloak_config_localization_settings:
  - realm: "demo01"
    supported_locales:
      - "en"
      - "de"
    default_locale: "en"

keycloak_config_custom_theme_hooks:
  - name: "custom-theme-hooks"
    realm: "demo01"
    source_path: "/opt/keycloak/themes/custom"
    notes: "Deploy custom realm theme assets/hooks with this release."

keycloak_config_smtp_settings:
  - realm: "demo01"
    host: "smtp.example.com"
    port: 587
    from: "keycloak@example.com"
    reply_to: "noreply@example.com"
    starttls: true
    ssl: false
    auth: true
    user: "keycloak@example.com"
    password: "install"

keycloak_config_password_policies:
  - realm: "demo01"
    policies:
      - "length(12)"
      - "digits(1)"
      - "specialChars(1)"

keycloak_config_bruteforce_settings:
  - realm: "demo01"
    enabled: true
    failure_factor: 5
    max_login_failures: 5
    wait_increment_seconds: 60
    quick_login_check_milli: 1000
    max_failure_wait_seconds: 900
    minimum_quick_login_wait_seconds: 60
    failure_reset_time_seconds: 900
    permanent_lockout: false

keycloak_config_auth_flow_settings:
  - realm: "demo01"
    browser_flow: "browser"
    direct_grant_flow: "direct grant"
    reset_credentials_flow: "reset credentials"
    client_authentication_flow: "clients"

keycloak_config_otp_settings:
  - realm: "demo01"
    otp_type: "totp"
    otp_policy_period: 30
    otp_policy_digits: 6
    otp_policy_algorithm: "HmacSHA1"

keycloak_config_event_settings:
  - realm: "demo01"
    events_enabled: true
    admin_events_enabled: true
    admin_events_details_enabled: true
    events_listeners:
      - "jboss-logging"

keycloak_config_session_settings:
  - realm: "demo01"
    remember_me: true

keycloak_config_token_settings:
  - realm: "demo01"

keycloak_config_event_listener_hooks:
  - realm: "demo01"
    name: "logging"
    listeners:
      - "jboss-logging"

# Terraform module source/version (override as needed)
keycloak_config_module_source: "lightning-it/instance/keycloak"
keycloak_config_module_version: "1.2.1"
