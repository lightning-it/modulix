---
# -----------------------------------------------------------------------------
# Wunderboxes - Core Services (no GUI)
#
# Purpose:
# - Enable required repos (e.g. EPEL via lit.rhel.repos *if you choose to*)
# - Apply wunderbox firewall policy (only if `firewall:` vars are provided)
# - Install & configure core services on wunderboxes:
#   - HashiCorp Vault
#   - Sonatype Nexus Repository Manager
#
# Notes:
# - Expect service roles:
#     - lit.supplementary.vault_validate / vault_deploy / vault_bootstrap / vault_config
#     - lit.supplementary.nexus
# -----------------------------------------------------------------------------

- name: Configure wunderboxes
  hosts: wunderboxes
  become: true
  gather_facts: true

  roles:
    - role: lit.rhel.repos
      tags: [repos]

    # Firewall System Role: only run if "firewall" var is provided (to avoid accidental resets)
    - role: fedora.linux_system_roles.firewall
      when: (firewall | default([], true) | length) > 0
      tags: [firewall]

    # HashiCorp Vault (service)
    - role: lit.supplementary.vault_deploy
      tags: [vault, deploy]

    - role: lit.supplementary.vault_validate
      tags: [vault, postflight, validate]

    - role: lit.supplementary.vault_bootstrap
      tags: [vault, bootstrap]

    - role: lit.supplementary.vault_config
      tags: [vault, configure]

    # Sonatype Nexus Repository Manager (service)
    - role: lit.supplementary.nexus
      tags: [nexus]
